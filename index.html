<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Tutorials</title>
    <!-- GitHub Markdown CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/github-markdown-css@5.2.0/github-markdown.min.css"
    />
    <style>
      body {
        background-color: #0d1117; /* dark theme */
        color: #c9d1d9;
        font-family: sans-serif;
        padding: 2rem;
      }
      .markdown-body {
        max-width: 900px;
        margin: auto;
      }
      a {
        color: #58a6ff;
      }
      #backBtn {
        margin-bottom: 1rem;
        padding: 0.5rem 1rem;
        background-color: #161b22;
        color: #58a6ff;
        border: 1px solid #30363d;
        border-radius: 6px;
        cursor: pointer;
      }
      #backBtn:hover {
        background-color: #21262d;
      }
    </style>
  </head>
  <body>
    <button id="backBtn">⬅ Back to Tutorials Hub</button>
    <div id="content" class="markdown-body"></div>

    <!-- Marked library -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      const backBtn = document.getElementById("backBtn");
      let backBtnHref = "./index.html";
      addEventListener("click", () => {
        window.location.href = backBtnHref; // main page
      });
      async function renderMarkdown(file) {
        try {
          const res = await fetch(file);
          const md = await res.text();

          // Convert markdown to HTML
          const html = marked.parse(md);
          const content = document.getElementById("content");
          content.innerHTML = html;
        } catch (err) {
          console.error("Error loading markdown:", err);
        }
      }
      function getTutorial() {
        const queryString = window.location.search; // "?tutorial=nodejs"

        // Parse the query string
        const urlParams = new URLSearchParams(queryString);

        // Get the "tutorial" parameter
        const tutorial = urlParams.get("tutorial");
        return tutorial;
      }
      async function init() {
        const tutorial = getTutorial();
        const path = tutorial ? `./tutorials/${tutorial}.md` : "README.md";
        await renderMarkdown(path);
        if (!tutorial) {
          backBtnHref = "https://github.com/younes-alhyan/tutorials-hub";
          backBtn.textContent = "🌐 View on GitHub";
          return;
        }
        const list = document.querySelector("ol");
        const items = list.querySelectorAll("li");
        const headers = document.querySelectorAll("h2");

        items.forEach((li, i) => {
          const a = li.querySelector("a");
          if (!a) return;

          const slug = a.getAttribute("href").slice(1); // remove #
          if (headers[i]) headers[i].id = slug;

          a.addEventListener("click", (e) => {
            e.preventDefault();
            const el = document.getElementById(slug);
            if (el) el.scrollIntoView({ behavior: "smooth" });
            history.pushState(null, "", `#${slug}`);
          });
        });

        // Scroll to hash if present
        const hash = decodeURIComponent(window.location.hash).slice(1);
        const el = document.getElementById(hash);
        if (el) el.scrollIntoView({ behavior: "smooth" });
      }

      init();
    </script>
  </body>
</html>
